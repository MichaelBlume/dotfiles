#!/bin/sh

if [ $# -eq 0 -o "${1:-}" = "-h" ] ; then
  echo "usage: $0 [-v] pattern [files]"
  return 1
fi

func='!d'
if [ "$1" = "-v" ]; then
  func='d'
  shift
fi

pattern="$1"
shift

sed -ure '/./{H;$!d;}; '"x;/${pattern}/$func;" $1

